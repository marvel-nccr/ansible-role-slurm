- name: set hostname to {{ slurm_hostname }}
  become: true
  hostname:
    name: "{{ slurm_hostname }}"
  # hostname works inconsistently on Docker containers: https://github.com/ansible/ansible/issues/19681
  # raising: Failed to create bus connection: No such file or directory
  when: not (cloud_platform is defined and cloud_platform == 'docker')

# Yaml requires escaping backslashes in double quotes but not in single quotes
# This usually works for docker, but it is not ideal
# Its better to set the hostname when starting the docker container (available as an option)
- name: Set hostname in /etc/hosts
  lineinfile:
    path: /etc/hosts
    regexp: "^(172\\.[0-9]+\\.[0-9]+\\.[0-9]+)\\s+.*$"
    line: "\\1 {{ slurm_hostname }}"
    backrefs: true
    unsafe_writes: true
  when: slurm_set_hostname or (cloud_platform is defined and cloud_platform == 'docker')
