# Adds a system service that re-configures the slurm compute resources on startup
# Note: This is necessary when preparing image that can start on a different hardware than it was built on

- name: copy init.d template
  become: true
  copy:
    src: "slurm-resources.sh"
    dest: "/etc/init.d/slurm-resources"
    mode: 0755

- name: enable service to set the slurm compute resources
  become: true
  command: update-rc.d slurm-resources defaults
  args:
    creates: "/etc/rc5.d/S??slurm-resources"

- name: start service to set the slurm compute resources
  become: true
  service:
    name: slurm-resources
    state: started
